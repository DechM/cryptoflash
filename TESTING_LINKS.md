# üîó –¢–µ—Å—Ç–æ–≤–∏ –õ–∏–Ω–∫–æ–≤–µ - CryptoFlash Plan Testing

## ‚úÖ –ö–∞–∫–≤–æ –µ —Ñ–∏–∫—Å–Ω–∞—Ç–æ:

1. **`/api/pay/confirm`** - –°–µ–≥–∞ –∑–∞–¥–∞–≤–∞ `cf_plan` cookie —Å–ª–µ–¥ –æ–±–Ω–æ–≤—è–≤–∞–Ω–µ –Ω–∞ –ø–ª–∞–Ω–∞ –≤ Supabase
2. **`/api/plan/me`** - –ß–µ—Ç–µ –æ—Ç Supabase (source of truth) –∞–∫–æ –∏–º–∞ `userId`, –∏–Ω–∞—á–µ fallback –∫—ä–º cookie
3. **`/test-payments`** - –ï–∫—Å–ø–ª–∏—Ü–∏—Ç–Ω–æ –∏–∑–≤–∏–∫–≤–∞ `/api/plan` POST —Å–ª–µ–¥ confirmation –∑–∞ –¥–∞ —Å–µ —É–≤–µ—Ä–∏ —á–µ cookie –µ –∑–∞–¥–∞–¥–µ–Ω

---

## üß™ –¢–µ—Å—Ç–æ–≤–∏ –°—Ç—Ä–∞–Ω–∏—Ü–∏ (—Å–ª–µ–¥ Vercel deploy):

### 1. **Payment Testing Page**
```
https://—Ç–≤–æ—è—Ç-–¥–æ–º–µ–π–Ω.vercel.app/test-payments
```
**–ö–∞–∫–≤–æ –¥–∞ —Ç–µ—Å—Ç–≤–∞—à:**
- –ù–∞—Ç–∏—Å–Ω–∏ "Test FREE" ‚Üí —Ç—Ä—è–±–≤–∞ –¥–∞ –ø–æ–∫–∞–∂–µ ‚úÖ FREE plan activated
- –ù–∞—Ç–∏—Å–Ω–∏ "Test PRO" ‚Üí —Ç—Ä—è–±–≤–∞ –¥–∞ –ø–æ–∫–∞–∂–µ ‚úÖ PRO plan activated (–Ω–µ "Plan mismatch")
- –ù–∞—Ç–∏—Å–Ω–∏ "Test ULTIMATE" ‚Üí —Ç—Ä—è–±–≤–∞ –¥–∞ –ø–æ–∫–∞–∂–µ ‚úÖ ULTIMATE plan activated

**–û—á–∞–∫–≤–∞–Ω–∏ —Ä–µ–∑—É–ª—Ç–∞—Ç–∏:**
- –ù–ï —Ç—Ä—è–±–≤–∞ –¥–∞ –≤–∏–∂–¥–∞—à "Plan mismatch" –≥—Ä–µ—à–∫–∏
- –¢—Ä—è–±–≤–∞ –¥–∞ –≤–∏–∂–¥–∞—à –ø—Ä–∞–≤–∏–ª–Ω–∏—Ç–µ features –∑–∞ –≤—Å–µ–∫–∏ –ø–ª–∞–Ω

---

### 2. **Feature Gating Test Page**
```
https://—Ç–≤–æ—è—Ç-–¥–æ–º–µ–π–Ω.vercel.app/test-features
```
**–ö–∞–∫–≤–æ –¥–∞ —Ç–µ—Å—Ç–≤–∞—à:**
- –°–ª–µ–¥ –∫–∞—Ç–æ –∞–∫—Ç–∏–≤–∏—Ä–∞—à –ø–ª–∞–Ω –æ—Ç `/test-payments`, –æ—Ç–∏–¥–∏ —Ç—É–∫
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ —â–µ –ø–æ–∫–∞–∂–µ –≤—Å–∏—á–∫–∏ —Ç–µ—Å—Ç–æ–≤–µ –∑–∞ —Ç–µ–∫—É—â–∏—è –ø–ª–∞–Ω
- –í—Å–∏—á–∫–∏ —Ç–µ—Å—Ç–æ–≤–µ —Ç—Ä—è–±–≤–∞ –¥–∞ —Å–∞ ‚úÖ (green)

**–û—á–∞–∫–≤–∞–Ω–∏ —Ä–µ–∑—É–ª—Ç–∞—Ç–∏ –∑–∞ FREE:**
- ‚úÖ Refresh: 30000ms
- ‚úÖ Max Tokens: 1
- ‚úÖ Threshold: ‚â•95%
- ‚úÖ Advanced Filters: false (‚ùå)
- ‚úÖ Whale Alerts: false (‚ùå)
- ‚úÖ Premium Analytics: false (‚ùå)

**–û—á–∞–∫–≤–∞–Ω–∏ —Ä–µ–∑—É–ª—Ç–∞—Ç–∏ –∑–∞ PRO:**
- ‚úÖ Refresh: 15000ms
- ‚úÖ Max Tokens: 10
- ‚úÖ Threshold: ‚â•85%
- ‚úÖ Advanced Filters: true (‚úÖ)
- ‚úÖ Whale Alerts: false (‚ùå)
- ‚úÖ Premium Analytics: false (‚ùå)

**–û—á–∞–∫–≤–∞–Ω–∏ —Ä–µ–∑—É–ª—Ç–∞—Ç–∏ –∑–∞ ULTIMATE:**
- ‚úÖ Refresh: 10000ms
- ‚úÖ Max Tokens: 10000 (unlimited)
- ‚úÖ Threshold: ‚â•80%
- ‚úÖ Advanced Filters: true (‚úÖ)
- ‚úÖ Whale Alerts: true (‚úÖ)
- ‚úÖ Premium Analytics: true (‚úÖ)

---

### 3. **Dashboard Page (–†—ä—á–Ω–æ —Ç–µ—Å—Ç–≤–∞–Ω–µ)**
```
https://—Ç–≤–æ—è—Ç-–¥–æ–º–µ–π–Ω.vercel.app/dashboard
```

**FREE –ø–ª–∞–Ω - –æ—á–∞–∫–≤–∞–Ω–æ:**
- ‚ùå Advanced Filters –ù–ï —Å–∞ –≤–∏–¥–∏–º–∏ (–≤–∏–∂–¥–∞—à "Upgrade to Pro" message)
- ‚ùå Export button –ù–ï –µ –≤–∏–¥–∏–º
- ‚úÖ Refresh rate: ~30 —Å–µ–∫—É–Ω–¥–∏ (–ø—Ä–æ–≤–µ—Ä–∏ –≤ Network tab)

**PRO –ø–ª–∞–Ω - –æ—á–∞–∫–≤–∞–Ω–æ:**
- ‚úÖ Advanced Filters —Å–∞ –≤–∏–¥–∏–º–∏ –∏ —Ä–∞–±–æ—Ç—è—Ç
- ‚ùå Export button –ù–ï –µ –≤–∏–¥–∏–º (—Å–∞–º–æ Ultimate)
- ‚úÖ Refresh rate: ~15 —Å–µ–∫—É–Ω–¥–∏

**ULTIMATE –ø–ª–∞–Ω - –æ—á–∞–∫–≤–∞–Ω–æ:**
- ‚úÖ Advanced Filters —Å–∞ –≤–∏–¥–∏–º–∏ –∏ —Ä–∞–±–æ—Ç—è—Ç
- ‚úÖ Export button –µ –≤–∏–¥–∏–º –∏ —Ä–∞–±–æ—Ç–∏ (download CSV)
- ‚úÖ Refresh rate: ~10 —Å–µ–∫—É–Ω–¥–∏

---

### 4. **Alerts Page (–†—ä—á–Ω–æ —Ç–µ—Å—Ç–≤–∞–Ω–µ)**
```
https://—Ç–≤–æ—è—Ç-–¥–æ–º–µ–π–Ω.vercel.app/alerts
```

**FREE –ø–ª–∞–Ω - –æ—á–∞–∫–≤–∞–Ω–æ:**
- ‚ùå Threshold slider –µ locked –Ω–∞ 95% (–Ω–µ –º–æ–∂–µ –¥–∞ —Å–µ –ø—Ä–æ–º–µ–Ω—è)
- ‚úÖ –ü–æ–∫–∞–∑–≤–∞ "1 token" –∏–ª–∏ "all tokens"
- ‚úÖ –í–∏–∂–¥–∞—à upgrade CTA

**PRO –ø–ª–∞–Ω - –æ—á–∞–∫–≤–∞–Ω–æ:**
- ‚úÖ Threshold slider –º–æ–∂–µ –¥–∞ —Å–µ –ø—Ä–æ–º–µ–Ω—è (85-100%)
- ‚úÖ –ü–æ–∫–∞–∑–≤–∞ "10 tokens"
- ‚úÖ –ú–æ–∂–µ—à –¥–∞ —Å—ä–∑–¥–∞–¥–µ—à –¥–æ 10 alerts

**ULTIMATE –ø–ª–∞–Ω - –æ—á–∞–∫–≤–∞–Ω–æ:**
- ‚úÖ Threshold slider –º–æ–∂–µ –¥–∞ —Å–µ –ø—Ä–æ–º–µ–Ω—è (80-100%)
- ‚úÖ –ü–æ–∫–∞–∑–≤–∞ "Unlimited tokens"
- ‚úÖ –ú–æ–∂–µ—à –¥–∞ —Å—ä–∑–¥–∞–¥–µ—à –Ω–µ–æ–≥—Ä–∞–Ω–∏—á–µ–Ω –±—Ä–æ–π alerts

---

## üîç –î–µ—Ç–∞–π–ª–Ω–∏ –¢–µ—Å—Ç–æ–≤–µ

### Test 1: FREE ‚Üí PRO Upgrade Flow
1. –û—Ç–∏–¥–∏ –Ω–∞ `/test-payments`
2. –ù–∞—Ç–∏—Å–Ω–∏ "Test FREE" ‚Üí –ø—Ä–æ–≤–µ—Ä–∏ —á–µ –µ FREE
3. –ù–∞—Ç–∏—Å–Ω–∏ "Test PRO" ‚Üí –ø—Ä–æ–≤–µ—Ä–∏ —á–µ —Å–µ –ø—Ä–æ–º–µ–Ω—è –Ω–∞ PRO
4. –û—Ç–∏–¥–∏ –Ω–∞ `/test-features` ‚Üí –≤—Å–∏—á–∫–∏ —Ç–µ—Å—Ç–æ–≤–µ —Ç—Ä—è–±–≤–∞ –¥–∞ —Å–∞ ‚úÖ –∑–∞ PRO
5. –û—Ç–∏–¥–∏ –Ω–∞ `/dashboard` ‚Üí Advanced Filters —Ç—Ä—è–±–≤–∞ –¥–∞ —Å–∞ –≤–∏–¥–∏–º–∏
6. –û—Ç–∏–¥–∏ –Ω–∞ `/alerts` ‚Üí Threshold —Ç—Ä—è–±–≤–∞ –¥–∞ –º–æ–∂–µ –¥–∞ —Å–µ –ø—Ä–æ–º–µ–Ω—è 85-100%

### Test 2: PRO ‚Üí ULTIMATE Upgrade Flow
1. –û—Ç–∏–¥–∏ –Ω–∞ `/test-payments`
2. –ù–∞—Ç–∏—Å–Ω–∏ "Test PRO" ‚Üí –ø—Ä–æ–≤–µ—Ä–∏ —á–µ –µ PRO
3. –ù–∞—Ç–∏—Å–Ω–∏ "Test ULTIMATE" ‚Üí –ø—Ä–æ–≤–µ—Ä–∏ —á–µ —Å–µ –ø—Ä–æ–º–µ–Ω—è –Ω–∞ ULTIMATE
4. –û—Ç–∏–¥–∏ –Ω–∞ `/test-features` ‚Üí –≤—Å–∏—á–∫–∏ —Ç–µ—Å—Ç–æ–≤–µ —Ç—Ä—è–±–≤–∞ –¥–∞ —Å–∞ ‚úÖ –∑–∞ ULTIMATE
5. –û—Ç–∏–¥–∏ –Ω–∞ `/dashboard` ‚Üí Export button —Ç—Ä—è–±–≤–∞ –¥–∞ –µ –≤–∏–¥–∏–º

### Test 3: ULTIMATE ‚Üí FREE Downgrade
1. –û—Ç–∏–¥–∏ –Ω–∞ `/test-payments`
2. –ù–∞—Ç–∏—Å–Ω–∏ "Test ULTIMATE" ‚Üí –ø—Ä–æ–≤–µ—Ä–∏ —á–µ –µ ULTIMATE
3. –ù–∞—Ç–∏—Å–Ω–∏ "Test FREE" ‚Üí –ø—Ä–æ–≤–µ—Ä–∏ —á–µ —Å–µ –ø—Ä–æ–º–µ–Ω—è –Ω–∞ FREE
4. –û—Ç–∏–¥–∏ –Ω–∞ `/test-features` ‚Üí –≤—Å–∏—á–∫–∏ —Ç–µ—Å—Ç–æ–≤–µ —Ç—Ä—è–±–≤–∞ –¥–∞ —Å–∞ ‚úÖ –∑–∞ FREE
5. –û—Ç–∏–¥–∏ –Ω–∞ `/dashboard` ‚Üí Advanced Filters –∏ Export –ù–ï —Ç—Ä—è–±–≤–∞ –¥–∞ —Å–∞ –≤–∏–¥–∏–º–∏

---

## ‚ö†Ô∏è –ü–æ—Ç–µ–Ω—Ü–∏–∞–ª–Ω–∏ –ü—Ä–æ–±–ª–µ–º–∏ (–∏ –∫–∞–∫ –¥–∞ –≥–∏ —Ñ–∏–∫—Å–Ω–µ—à):

### –ü—Ä–æ–±–ª–µ–º: "Plan mismatch" –≤—Å–µ –æ—â–µ —Å–µ –ø–æ–∫–∞–∑–≤–∞
**–†–µ—à–µ–Ω–∏–µ:**
- –ü—Ä–æ–≤–µ—Ä–∏ —á–µ `ALLOW_MOCK_PAYMENT=true` –µ –≤ Vercel
- –ò–∑—á–∞–∫–∞–π 2-3 —Å–µ–∫—É–Ω–¥–∏ —Å–ª–µ–¥ confirmation –ø—Ä–µ–¥–∏ refresh
- –ü—Ä–æ–≤–µ—Ä–∏ browser console –∑–∞ errors
- –ü—Ä–æ–≤–µ—Ä–∏ Vercel logs –∑–∞ API errors

### –ü—Ä–æ–±–ª–µ–º: Features –Ω–µ —Å–µ –ø—Ä–æ–º–µ–Ω—è—Ç —Å–ª–µ–¥ upgrade
**–†–µ—à–µ–Ω–∏–µ:**
- Hard refresh (Ctrl+Shift+R –∏–ª–∏ Cmd+Shift+R)
- –ü—Ä–æ–≤–µ—Ä–∏ cookie `cf_plan` –≤ DevTools ‚Üí Application ‚Üí Cookies
- –ü—Ä–æ–≤–µ—Ä–∏ —á–µ `/api/plan/me` –≤—Ä—ä—â–∞ –ø—Ä–∞–≤–∏–ª–Ω–∏—è –ø–ª–∞–Ω

### –ü—Ä–æ–±–ª–µ–º: Server-side guards –Ω–µ —Ä–∞–±–æ—Ç—è—Ç
**–†–µ—à–µ–Ω–∏–µ:**
- –ü—Ä–æ–≤–µ—Ä–∏ Vercel logs –∑–∞ `/api/alerts/subscribe` errors
- –ü—Ä–æ–≤–µ—Ä–∏ —á–µ Supabase `users.subscription_status` –µ –ø—Ä–∞–≤–∏–ª–Ω–æ –æ–±–Ω–æ–≤–µ–Ω
- –ü—Ä–æ–≤–µ—Ä–∏ `/api/alerts/history` –∑–∞ –ø—Ä–∞–≤–∏–ª–Ω–∞ gating –ª–æ–≥–∏–∫–∞

---

## ‚úÖ Success Criteria

**–¢–µ—Å—Ç—ä—Ç –µ —É—Å–ø–µ—à–µ–Ω –∞–∫–æ:**
1. ‚úÖ –í—Å–∏—á–∫–∏ –ø–ª–∞–Ω–æ–≤–µ —Å–µ –∞–∫—Ç–∏–≤–∏—Ä–∞—Ç –±–µ–∑ "Plan mismatch" –≥—Ä–µ—à–∫–∏
2. ‚úÖ `/test-features` –ø–æ–∫–∞–∑–≤–∞ –≤—Å–∏—á–∫–∏ —Ç–µ—Å—Ç–æ–≤–µ ‚úÖ –∑–∞ –∞–∫—Ç–∏–≤–Ω–∏—è –ø–ª–∞–Ω
3. ‚úÖ UI –µ–ª–µ–º–µ–Ω—Ç–∏ —Å–µ –ø–æ–∫–∞–∑–≤–∞—Ç/—Å–∫—Ä–∏–≤–∞—Ç —Å–ø–æ—Ä–µ–¥ –ø–ª–∞–Ω–∞
4. ‚úÖ Refresh rates —Å–∞ –ø—Ä–∞–≤–∏–ª–Ω–∏ (30s/15s/10s)
5. ‚úÖ Server-side guards –±–ª–æ–∫–∏—Ä–∞—Ç –Ω–µ—Ä–∞–∑—Ä–µ—à–µ–Ω–∏ actions
6. ‚úÖ –ù—è–º–∞ TypeScript –∏–ª–∏ runtime errors –≤ console

---

## üìù Notes

- –í—Å–∏—á–∫–∏ –ø–ª–∞–Ω–æ–≤–µ —Å–µ —Ç–µ—Å—Ç–≤–∞—Ç —Å **mock payments** (–Ω—è–º–∞ —Ä–µ–∞–ª–Ω–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏)
- –ó–∞ production, —Ç—Ä—è–±–≤–∞ –¥–∞ –ø—Ä–µ–º–∞—Ö–Ω–µ—à `ALLOW_MOCK_PAYMENT=true` –∏–ª–∏ –¥–∞ –≥–æ –æ—Å—Ç–∞–≤–∏—à —Å–∞–º–æ –∑–∞ testing
- Supabase –µ source of truth –∑–∞ –ø–ª–∞–Ω–æ–≤–µ—Ç–µ - cookie –µ —Å–∞–º–æ –∑–∞ UI cache

---

**–°–ª–µ–¥ –∫–∞—Ç–æ —Ç–µ—Å—Ç–≤–∞—à –≤—Å–∏—á–∫–æ, —Å–ø–æ–¥–µ–ª–∏ —Ä–µ–∑—É–ª—Ç–∞—Ç–∏—Ç–µ! üöÄ**

